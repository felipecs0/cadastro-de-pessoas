<main class="surface-ground min-h-screen py-4 px-2 md:px-4" role="main">
  <div class="flex justify-content-center">
    <div class="w-full max-w-30rem">

      <!-- Header -->
      <header class="text-center mb-6">
        <h1 class="text-3xl font-medium text-900 mb-2" id="cadastro-heading">
          Cadastrar Pessoa
        </h1>
        <p class="text-600 line-height-3 m-0" id="cadastro-description">
          Preencha os dados abaixo para cadastrar uma nova pessoa
        </p>
      </header>

      <!-- Formulário -->
      <form [formGroup]="pessoaForm"
            (ngSubmit)="verDadosPessoa()"
            class="surface-card p-4 shadow-2 border-round"
            novalidate
            aria-labelledby="cadastro-heading"
            aria-describedby="cadastro-description">

        <div class="flex flex-column gap-4">

          <!-- Campo Nome -->
          <div class="field">
            <label for="nome" class="block text-900 font-medium mb-2">
              Nome Completo
              <span class="text-red-500 ml-1" aria-label="Campo obrigatório">*</span>
            </label>
            <input
              id="nome"
              type="text"
              pInputText
              formControlName="nome"
              class="w-full"
              [class.ng-invalid]="pessoaForm.get('nome')?.invalid && pessoaForm.get('nome')?.touched"
              [class.ng-dirty]="pessoaForm.get('nome')?.dirty"
              placeholder="Digite o nome completo"
              autocomplete="name"
              aria-required="true"
              aria-describedby="nome-help nome-error" />

            <!-- Mensagem de erro -->
            <small *ngIf="pessoaForm.get('nome')?.invalid && pessoaForm.get('nome')?.touched"
                   id="nome-error"
                   class="block text-red-500 mt-1">
              {{ getErrorMessage('nome') }}
            </small>

            <small *ngIf="!pessoaForm.get('nome')?.invalid || !pessoaForm.get('nome')?.touched"
                   id="nome-help"
                   class="block text-600 mt-1">
              Informe o nome completo da pessoa
            </small>
          </div>

          <!-- Campo CPF -->
          <div class="field">
            <label for="cpf" class="block text-900 font-medium mb-2">
              CPF
              <span class="text-red-500 ml-1" aria-label="Campo obrigatório">*</span>
            </label>
            <input
              id="cpf"
              type="text"
              pInputText
              formControlName="cpf"
              (input)="onCpfInput($event)"
              class="w-full"
              [class.ng-invalid]="pessoaForm.get('cpf')?.invalid && pessoaForm.get('cpf')?.touched"
              [class.ng-dirty]="pessoaForm.get('cpf')?.dirty"
              placeholder="000.000.000-00"
              maxlength="14"
              autocomplete="off"
              aria-required="true"
              aria-describedby="cpf-help cpf-error" />

            <!-- Mensagem de erro -->
            <small *ngIf="pessoaForm.get('cpf')?.invalid && pessoaForm.get('cpf')?.touched"
                   id="cpf-error"
                   class="block text-red-500 mt-1">
              {{ getErrorMessage('cpf') }}
            </small>

            <small *ngIf="!pessoaForm.get('cpf')?.invalid || !pessoaForm.get('cpf')?.touched"
                   id="cpf-help"
                   class="block text-600 mt-1">
              Digite apenas números, a formatação será aplicada automaticamente
            </small>
          </div>

          <!-- Campo Sexo -->
          <div class="field">
            <label for="sexo" class="block text-900 font-medium mb-2">
              Sexo
              <span class="text-red-500 ml-1" aria-label="Campo obrigatório">*</span>
            </label>
            <p-select
              inputId="sexo"
              formControlName="sexo"
              [options]="sexoOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Selecione o sexo"
              styleClass="w-full"
              [class.ng-invalid]="pessoaForm.get('sexo')?.invalid && pessoaForm.get('sexo')?.touched"
              [class.ng-dirty]="pessoaForm.get('sexo')?.dirty"
              aria-required="true"
              aria-describedby="sexo-help sexo-error">
            </p-select>

            <!-- Mensagem de erro -->
            <small *ngIf="pessoaForm.get('sexo')?.invalid && pessoaForm.get('sexo')?.touched"
                   id="sexo-error"
                   class="block text-red-500 mt-1">
              {{ getErrorMessage('sexo') }}
            </small>

            <small *ngIf="!pessoaForm.get('sexo')?.invalid || !pessoaForm.get('sexo')?.touched"
                   id="sexo-help"
                   class="block text-600 mt-1">
              Selecione uma das opções disponíveis
            </small>
          </div>

          <!-- Campo Email -->
          <div class="field">
            <label for="email" class="block text-900 font-medium mb-2">
              E-mail
              <span class="text-red-500 ml-1" aria-label="Campo obrigatório">*</span>
            </label>
            <input
              id="email"
              type="email"
              pInputText
              formControlName="email"
              class="w-full"
              [class.ng-invalid]="pessoaForm.get('email')?.invalid && pessoaForm.get('email')?.touched"
              [class.ng-dirty]="pessoaForm.get('email')?.dirty"
              placeholder="exemplo@email.com"
              autocomplete="email"
              aria-required="true"
              aria-describedby="email-help email-error" />

            <!-- Mensagem de erro -->
            <small *ngIf="pessoaForm.get('email')?.invalid && pessoaForm.get('email')?.touched"
                   id="email-error"
                   class="block text-red-500 mt-1">
              {{ getErrorMessage('email') }}
            </small>

            <small *ngIf="!pessoaForm.get('email')?.invalid || !pessoaForm.get('email')?.touched"
                   id="email-help"
                   class="block text-600 mt-1">
              Informe um endereço de e-mail válido
            </small>
          </div>

          <!-- Campo Telefone -->
          <div class="field">
            <label for="telefone" class="block text-900 font-medium mb-2">
              Telefone
            </label>
            <input
              id="telefone"
              type="tel"
              pInputText
              formControlName="telefone"
              (input)="onTelefoneInput($event)"
              class="w-full"
              [class.ng-invalid]="pessoaForm.get('telefone')?.invalid && pessoaForm.get('telefone')?.touched"
              [class.ng-dirty]="pessoaForm.get('telefone')?.dirty"
              placeholder="(00) 00000-0000"
              maxlength="15"
              autocomplete="tel"
              aria-describedby="telefone-help telefone-error" />

            <!-- Mensagem de erro -->
            <small *ngIf="pessoaForm.get('telefone')?.invalid && pessoaForm.get('telefone')?.touched"
                   id="telefone-error"
                   class="block text-red-500 mt-1">
              {{ getErrorMessage('telefone') }}
            </small>

            <small *ngIf="!pessoaForm.get('telefone')?.invalid || !pessoaForm.get('telefone')?.touched"
                   id="telefone-help"
                   class="block text-600 mt-1">
              Telefone com DDD (opcional)
            </small>
          </div>

        </div>

        <!-- Ações -->
        <div class="flex flex-column md:flex-row gap-3 mt-6">
          <button
            type="button"
            pButton
            label="Cancelar"
            class="p-button-outlined p-button-secondary flex-1"
            aria-label="Cancelar cadastro e voltar à página anterior">
            <i class="pi pi-times mr-2" aria-hidden="true"></i>
          </button>

          <button
            type="submit"
            pButton
            label="Cadastrar"
            class="p-button-primary flex-1"
            aria-label="Salvar dados da pessoa">
            <i class="pi pi-check mr-2" aria-hidden="true"></i>
          </button>
        </div>

        <!-- Informação sobre campos obrigatórios -->
        <div class="mt-4 p-3 surface-100 border-round text-center">
          <small class="text-600">
            <i class="pi pi-info-circle mr-1" aria-hidden="true"></i>
            Os campos marcados com <span class="text-red-500 font-medium">*</span> são obrigatórios
          </small>
        </div>

        <!-- Debug do formulário (remover em produção) -->
        <div class="mt-4 p-3 surface-200 border-round" *ngIf="false">
          <h4>Debug do Formulário:</h4>
          <p><strong>Status:</strong> {{ pessoaForm.status }}</p>
          <p><strong>Válido:</strong> {{ pessoaForm.valid }}</p>
          <p><strong>Valores:</strong></p>
          <pre>{{ pessoaForm.value | json }}</pre>
          <p><strong>Erros:</strong></p>
          <pre>{{ getFormErrors() | json }}</pre>
        </div>

      </form>

    </div>
  </div>
</main>

<!-- Toast para feedback do usuário -->
<p-toast
  position="top-right"
  key="cadastro"
  [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"
  aria-live="polite"
  aria-label="Notificações do sistema">
</p-toast>
